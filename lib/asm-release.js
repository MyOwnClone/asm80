/*

Multitarget assembler (C) 2013 Martin Maly, http://www.maly.cz, http://www.webscript.cz

Permission is hereby granted, free of charge, to any person
obtaining a copy of this software and associated documentation
files (the "Software"), to deal in the Software without
restriction, including without limitation the rights to use,
copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the
Software is furnished to do so, subject to the following
conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
OTHER DEALINGS IN THE SOFTWARE.

 Parser is based on ndef.parser, by Raphael Graf(r@undefined.ch)
 http://www.undefined.ch/mparser/index.html

 Ported to JavaScript and modified by Matthew Crumley (email@matthewcrumley.com, http://silentmatt.com/)

 You are free to use and modify this code in anyway you find useful. Please leave this comment in the code
 to acknowledge its original source. If you feel like it, I enjoy hearing about projects that use my code,
 but don't feel like you have to let me know or ask permission.
*/

var Z80={set:{DEC:[-1,-1,-1,-1,5,-1,11,-1,-1,-1,-1,-1,-1,-1],INC:[-1,-1,-1,-1,4,-1,3,-1,-1,-1,-1,-1,-1,-1],AND:[-1,-1,-1,-1,160,230,-1,-1,-1,-1,-1,-1,-1,-1],OR:[-1,-1,-1,-1,176,246,-1,-1,-1,-1,-1,-1,-1,-1],XOR:[-1,-1,-1,-1,168,238,-1,-1,-1,-1,-1,-1,-1,-1],SUB:[-1,-1,-1,-1,144,214,-1,-1,-1,-1,-1,-1,-1,-1],CP:[-1,-1,-1,-1,184,254,-1,-1,-1,-1,-1,-1,-1,-1],SLA:[-1,-1,-1,-1,52000,-1,-1,-1,-1,-1,-1,-1,-1,-1],SRA:[-1,-1,-1,-1,52008,-1,-1,-1,-1,-1,-1,-1,-1,-1],SRL:[-1,-1,-1,-1,52024,-1,-1,-1,-1,-1,-1,-1,-1,-1],RR:[-1,-1,-1,-1,51992,-1,-1,-1,-1,-1,-1,-1,-1,-1],RL:[-1,-1,-1,-1,51984,-1,-1,-1,-1,-1,-1,-1,-1,-1],RRC:[-1,-1,-1,-1,51976,-1,-1,-1,-1,-1,-1,-1,-1,-1],RLC:[-1,-1,-1,-1,51968,-1,-1,-1,-1,-1,-1,-1,-1,-1],POP:[-1,-1,-1,-1,-1,-1,-1,193,-1,-1,-1,-1,-1,-1],PUSH:[-1,-1,-1,-1,-1,-1,-1,197,-1,-1,-1,-1,-1,-1],RET:[201,-1,-1,-1,-1,-1,-1,-1,192,-1,-1,-1,-1,-1],IM:[-1,-1,-1,-1,-1,-1,-1,-1,-1,60742,-1,-1,-1,-1],RST:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,199,-1,-1,-1],CALL:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,205,-1],JP:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,195,233],DJNZ:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,16,-1,-1],JR:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,24,-1,-1],NOP:[0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],CCF:[63,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],CPD:[60841,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],CPDR:[60857,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],CPI:[60833,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],CPIR:[60849,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],CPL:[47,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],DAA:[39,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],DI:[243,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],EI:[251,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],EXX:[217,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],IND:[60842,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],INDR:[60858,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],INI:[60834,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],INIR:[60850,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],LDD:[60840,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],LDDR:[60856,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],LDI:[60832,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],LDIR:[60848,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],OUTD:[60843,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],OTDR:[60859,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],OUTI:[60835,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],OTIR:[60851,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],HALT:[118,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],NEG:[60740,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],RETI:[60749,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],RETN:[60741,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],RLA:[23,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],RLCA:[7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],RLD:[60783,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],RRA:[31,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],RRCA:[15,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],RRD:[60775,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],SCF:[55,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],EX:[0],LD:[0],ADC:[136,206,60746],ADD:[128,198,9,9],SBC:[152,222,60745],BIT:[-1,-1,-1,-1,52032],RES:[-1,-1,-1,-1,52096],SET:[-1,-1,-1,-1,52160],CAL2:[-1,-1,-1,-1,-1,196],JP2:[-1,-1,-1,-1,-1,194],JR2:[-1,-1,-1,-1,-1,32],IN:[60736,219,-1,-1,-1,-1],OUT:[60737,211,-1,-1,-1,-1]},R8:{DEC:3,INC:3},R16:{DEC:4,INC:4,POP:4,PUSH:4},parseOpcode:function(n){var t=function(s){var F=["B","C","D","E","H","L","~","A"].indexOf(s.toUpperCase());
if(s.toUpperCase()=="(HL)"){return 6;}return F;};var D=function(s){return["B","C","D","E","H","L","F","A"].indexOf(s.toUpperCase());};var C=function(s){var F=["BC","DE","HL","SP"].indexOf(s.toUpperCase());
return F;};var w=function(s){var F=["BC","DE","IX","SP"].indexOf(s.toUpperCase());return F;};var r=function(s){var F=["BC","DE","IY","SP"].indexOf(s.toUpperCase());
return F;};var f=function(s){var F=["BC","DE","HL","AF"].indexOf(s.toUpperCase());return F;};var z=function(s){var F=["NZ","Z","NC","C","PO","PE","P","M"].indexOf(s.toUpperCase());
return F;};var q=function(s){if(s[0]=="("&&s[s.length-1]==")"){return s.substr(1,s.length-2);}else{return null;}};var e=function(G){var F,H;var s=G.substr(0,4).toUpperCase();
if(s=="(IX+"){F=G.substr(4,G.length-5);H=221;G="(HL)";}if(s=="(IY+"){F=G.substr(4,G.length-5);H=253;G="(HL)";}if(s=="IX"){H=221;G="HL";}if(s=="IY"){H=253;
G="HL";}if(s=="IXL"){H=221;G="L";}if(s=="IXH"){H=221;G="H";}if(s=="IYL"){H=253;G="L";}if(s=="IYH"){H=253;G="H";}return[G,F,H];};var h=Z80.set[n.opcode];
var g=-1,p=1,E=[];var x=null,v=null;var d,c;if(h){if(!n.params){g=h[0];}else{if(n.params.length==1){var m=n.params[0];var o=e(m);m=o[0];v=o[1];x=o[2];if(h[11]>0){n.bytes=2;
n.lens=[];n.lens[0]=h[11];n.lens[1]=function(H){var G=Parser.evaluate(m,H);var F=H._PC+2;var s=G-F;if(s>127){throw"Target is out of relative jump reach";
}if(s<-128){throw"Target is out of relative jump reach";}if(s<0){s=256+s;}return s;};return n;}if(h[12]>0){n.lens=[];if(m.toUpperCase()=="(HL)"&&h[13]>0){n.bytes=1;
n.lens[0]=h[13];return n;}if(m.toUpperCase()=="(IX)"&&h[13]>0){n.bytes=2;n.lens[0]=221;n.lens[1]=h[13];return n;}if(m.toUpperCase()=="(IY)"&&h[13]>0){n.bytes=2;
n.lens[0]=253;n.lens[1]=h[13];return n;}n.bytes=3;n.lens[0]=h[12];n.lens[1]=function(s){return Parser.evaluate(m,s);};n.lens[2]=null;return n;}if(h[9]>0){n.bytes=2;
n.lens=[];n.lens[0]=237;var l=Parser.evaluate(m);switch(l){case 0:n.lens[1]=70;return n;case 1:n.lens[1]=86;return n;case 2:n.lens[1]=94;return n;}throw"Invalid interrupt mode";
}if(h[10]>0){n.bytes=1;n.lens=[];var l=Parser.evaluate(m);switch(l){case 0:n.lens[0]=199;return n;case 8:n.lens[0]=207;return n;case 16:n.lens[0]=215;return n;
case 24:n.lens[0]=223;return n;case 32:n.lens[0]=231;return n;case 40:n.lens[0]=239;return n;case 48:n.lens[0]=247;return n;case 56:n.lens[0]=255;return n;
}throw"Invalid RST";}d=z(m);if(d>=0&&h[8]>0){g=h[8];if(g>0){g+=d<<3;}}else{d=C(m);if(d>=0&&h[6]>=0){g=h[6];if(g>0){if(Z80.R16[n.opcode]){g+=d<<Z80.R16[n.opcode];
}else{g+=d;}}}else{d=f(m);if(d>=0&&h[7]>=0){g=h[7];if(g>0){if(Z80.R16[n.opcode]){g+=d<<Z80.R16[n.opcode];}else{g+=d;}}}else{d=t(m);if(d>=0&&h[4]>0){g=h[4];
if(g>0){if(Z80.R8[n.opcode]){g+=d<<Z80.R8[n.opcode];}else{g+=d;}}}else{g=h[5];c=function(s){return Parser.evaluate(m,s);};}}}}}else{if(n.params.length==2){var b=n.params[0];
var a=n.params[1];if(n.opcode=="EX"){if(b.toUpperCase()=="DE"&&a.toUpperCase()=="HL"){n.lens=[235];n.bytes=1;return n;}if(b.toUpperCase()=="AF"&&a.toUpperCase()=="AF'"){n.lens=[8];
n.bytes=1;return n;}if(b.toUpperCase()=="(SP)"&&a.toUpperCase()=="HL"){n.lens=[227];n.bytes=1;return n;}if(b.toUpperCase()=="(SP)"&&a.toUpperCase()=="IX"){n.lens=[221,227];
n.bytes=2;return n;}if(b.toUpperCase()=="(SP)"&&a.toUpperCase()=="IY"){n.lens=[253,227];n.bytes=2;return n;}return null;}if(n.opcode=="CALL"){h=Z80.set.CAL2;
d=z(b);if(d>=0&&h[5]>0){g=h[5];if(g>0){g+=d<<3;n.bytes=3;n.lens=[];n.lens[0]=g;n.lens[1]=function(s){return Parser.evaluate(a,s);};n.lens[2]=null;return n;
}}return null;}if(n.opcode=="JP"){h=Z80.set.JP2;d=z(b);if(d>=0&&h[5]>0){g=h[5];if(g>0){g+=d<<3;n.bytes=3;n.lens=[];n.lens[0]=g;n.lens[1]=function(s){return Parser.evaluate(a,s);
};n.lens[2]=null;return n;}}return null;}if(n.opcode=="JR"){h=Z80.set.JR2;d=z(b);if(d>=0&&d<4&&h[5]>0){g=h[5];if(g>0){g+=d<<3;n.bytes=2;n.lens=[];n.lens[0]=g;
n.lens[1]=function(H){var G=Parser.evaluate(a,H);var F=H._PC+2;var s=G-F;if(s>127){throw"Target is out of relative jump reach";}if(s<-128){throw"Target is out of relative jump reach";
}if(s<0){s=256+s;}return s;};return n;}}return null;}if(n.opcode=="IN"){if(a.toUpperCase()=="(C)"){d=D(b);if(d>=0&&h[0]){n.lens=[237,64+(d<<3)];n.bytes=2;
return n;}}if(b.toUpperCase()=="A"){n.lens=[h[1]];n.lens[1]=function(s){return Parser.evaluate(a,s);};n.bytes=2;return n;}return null;}if(n.opcode=="OUT"){if(b.toUpperCase()=="(C)"){d=D(a);
if(d>=0&&h[0]){n.lens=[237,65+(d<<3)];n.bytes=2;return n;}}if(a.toUpperCase()=="A"){n.lens=[h[1]];n.lens[1]=function(s){return Parser.evaluate(b,s);};n.bytes=2;
return n;}return null;}if(n.opcode=="LD"){if(b.toUpperCase()=="A"&&a.toUpperCase()=="R"){n.bytes=2;n.lens=[237,95];return n;}if(b.toUpperCase()=="A"&&a.toUpperCase()=="I"){n.bytes=2;
n.lens=[237,87];return n;}if(b.toUpperCase()=="R"&&a.toUpperCase()=="A"){n.bytes=2;n.lens=[237,79];return n;}if(b.toUpperCase()=="I"&&a.toUpperCase()=="A"){n.bytes=2;
n.lens=[237,71];return n;}var y=e(b);b=y[0];v=y[1];x=y[2];var u=e(a);a=u[0];if(u[1]&&v){throw"Invalid parameters - two indexed";}if(u[1]){v=u[1];}if(u[2]&&x){throw"Invalid parameters - two prefixed";
}if(u[2]){x=u[2];}var B=t(b);var A=t(a);E=[];if(B>=0&&A>=0){n.bytes=1;E[0]=64+(B<<3)+A;}if(b.toUpperCase()=="A"&&a.toUpperCase()=="(BC)"){n.bytes=1;n.lens=[10];
return n;}if(b.toUpperCase()=="A"&&a.toUpperCase()=="(DE)"){n.bytes=1;n.lens=[26];return n;}if(b.toUpperCase()=="A"&&q(a)&&n.bytes==0){n.bytes=3;n.lens=[58,function(s){return Parser.evaluate(q(a),s);
},null];return n;}if(b.toUpperCase()=="(BC)"&&a.toUpperCase()=="A"){n.bytes=1;n.lens=[2];return n;}if(b.toUpperCase()=="(DE)"&&a.toUpperCase()=="A"){n.bytes=1;
n.lens=[18];return n;}if(q(b)&&a.toUpperCase()=="A"&&n.bytes==0){n.bytes=3;n.lens=[50,function(s){return Parser.evaluate(q(b),s);},null];return n;}if(B>=0&&A<0){n.bytes=2;
E[0]=6+(B<<3);E[1]=function(s){return Parser.evaluate(a,s);};}if(n.bytes==0){B=C(b);A=C(a);var k=q(b);var j=q(a);if(B>=0&&!j){n.bytes=3;E=[1+(B<<4),function(s){return Parser.evaluate(a,s);
},null];}if(B>=0&&j){n.bytes=([4,4,3,4])[B];E=[237,75+(B<<4),function(s){return Parser.evaluate(j,s);},null];if(n.bytes==3){E=[42,function(s){return Parser.evaluate(j,s);
},null];}}if(k&&A>=0){n.bytes=([4,4,3,4])[A];E=[237,67+(A<<4),function(s){return Parser.evaluate(k,s);},null];if(n.bytes==3){E=[34,function(s){return Parser.evaluate(k,s);
},null];}}if(B==3&&A==2){n.bytes=1;E=[249];}}if(!E.length){return null;}if(x){E.unshift(x);n.bytes++;}if(v){if(n.bytes==3){E[3]=E[2];E[2]=Parser.evaluate(v);
n.bytes=4;}if(n.bytes==2){E[2]=Parser.evaluate(v);n.bytes=3;}}n.lens=E;return n;}if(h[4]>=0){var i=parseInt(b,10);var o=e(a);a=o[0];v=o[1];x=o[2];d=t(a);
g=h[4]+(8*i)+d;}if(b.toUpperCase()=="A"){var o=e(a);a=o[0];v=o[1];x=o[2];if((d=t(a))>=0){g=h[0]+d;}else{g=h[1];c=function(s){return Parser.evaluate(a,s);
};}}if(b.toUpperCase()=="IX"){if((d=w(a))>=0){g=h[2]+(d<<4);x=221;}}if(b.toUpperCase()=="IY"){if((d=r(a))>=0){g=h[2]+(d<<4);x=253;}}if(b.toUpperCase()=="HL"){if((d=C(a))>=0){g=h[2]+(d<<4);
}}}}}if(g<0){throw"Bad addressing mode at line "+n.numline;}if(g>255){p++;E[0]=(g&65280)>>8;E[1]=(g&255);}else{E[0]=(g&255);}if(x){E.unshift(x);p++;}if(v){if(p==3){E[3]=E[2];
E[2]=Parser.evaluate(v);p=4;}if(p==2){E[2]=Parser.evaluate(v);p=3;}}if(c){E.push(c);p++;}n.lens=E;n.bytes=p;return n;}return null;}};var I8080={set:{RST:{o:199,t:"RST"},LDA:{o:58,t:"IW"},STA:{o:50,t:"IW"},LDAX:{o:10,t:"BD"},STAX:{o:2,t:"BD"},LHLD:{o:42,t:"IW"},SHLD:{o:34,t:"IW"},JMP:{o:195,t:"IW"},JNZ:{o:194,t:"IW"},JZ:{o:202,t:"IW"},JNC:{o:210,t:"IW"},JC:{o:218,t:"IW"},JPO:{o:226,t:"IW"},JPE:{o:234,t:"IW"},JP:{o:242,t:"IW"},JM:{o:250,t:"IW"},JNK:{o:221,t:"IW"},JK:{o:253,t:"IW"},CALL:{o:205,t:"IW"},CNZ:{o:196,t:"IW"},CZ:{o:204,t:"IW"},CNC:{o:212,t:"IW"},CC:{o:220,t:"IW"},CPO:{o:228,t:"IW"},CPE:{o:236,t:"IW"},CP:{o:244,t:"IW"},CM:{o:252,t:"IW"},LXI:{o:1,t:"RPW"},DAD:{o:9,t:"RPWD"},INX:{o:3,t:"RPWD"},DCX:{o:11,t:"RPWD"},PUSH:{o:197,t:"RQW"},POP:{o:193,t:"RQW"},MVI:{o:6,t:"RB"},ADI:{o:198,t:"B"},ACI:{o:206,t:"B"},SUI:{o:214,t:"B"},SBI:{o:222,t:"B"},ANI:{o:230,t:"B"},XRI:{o:238,t:"B"},ORI:{o:246,t:"B"},CPI:{o:254,t:"B"},INR:{o:4,t:"RR"},DCR:{o:5,t:"RR"},MOV:{o:64,t:"RRR"},HLT:{o:118,t:"0"},NOP:{o:0,t:"0"},IN:{o:219,t:"B"},OUT:{o:211,t:"B"},RIM:{o:32,t:"0"},SIM:{o:48,t:"0"},ADD:{o:128,t:"RR0"},ADC:{o:136,t:"RR0"},SUB:{o:144,t:"RR0"},SBB:{o:152,t:"RR0"},ANA:{o:160,t:"RR0"},XRA:{o:168,t:"RR0"},ORA:{o:176,t:"RR0"},CMP:{o:184,t:"RR0"},EI:{o:251,t:"0"},DI:{o:243,t:"0"},SPHL:{o:249,t:"0"},XCHG:{o:235,t:"0"},XTHL:{o:227,t:"0"},DAA:{o:39,t:"0"},CMA:{o:47,t:"0"},STC:{o:55,t:"0"},CMC:{o:63,t:"0"},RLC:{o:7,t:"0"},RRC:{o:15,t:"0"},RAL:{o:23,t:"0"},RAR:{o:31,t:"0"},RRHL:{o:16,t:"0"},RLDE:{o:24,t:"0"},PCHL:{o:233,t:"0"},DSUB:{o:8,t:"0"},RSTV:{o:203,t:"0"},RET:{o:201,t:"0"},RNZ:{o:192,t:"0"},RZ:{o:200,t:"0"},RNC:{o:208,t:"0"},RC:{o:216,t:"0"},RPO:{o:224,t:"0"},RPE:{o:232,t:"0"},RP:{o:240,t:"0"},RM:{o:248,t:"0"}},lens:{R:function(a){return"BCDEHLMA".indexOf(a.toUpperCase());
},RDD:function(a){return"BDHSP".indexOf(a.toUpperCase());},RBD:function(a){return"BD".indexOf(a.toUpperCase());},RQQ:function(a){return"BDHPSW".indexOf(a.toUpperCase());
},RB:function(c,b){var a=this.R(b[0]);if(a<0){throw"Unknown register "+b[0];}a<<=3;return[a|c,function(d){return Parser.evaluate(b[1],d);}];},B:function(b,a){return[b,function(c){return Parser.evaluate(a[0],c);
}];},RR:function(c,b){var a=this.R(b[0]);if(a<0){throw"Unknown register "+b[0];}a<<=3;return[a|c];},RR0:function(c,b){var a=this.R(b[0]);if(a<0){throw"Unknown register "+b[0];
}return[a|c];},RRR:function(d,c){var b=this.R(c[0]);if(b<0){throw"Unknown register "+c[0];}var a=this.R(c[1]);if(a<0){throw"Unknown register "+c[1];}b<<=3;
return[b|a|d];},RPW:function(c,b){var a=this.RDD(b[0]);if(a<0||a>3){throw"Unknown register "+b[0];}a<<=4;return[a|c,function(d){return Parser.evaluate(b[1],d);
},null];},RPWD:function(c,b){var a=this.RDD(b[0]);if(a<0||a>3){throw"Unknown register "+b[0];}a<<=4;return[a|c];},BD:function(c,b){var a=this.RBD(b[0]);
if(a<0||a>1){throw"Unknown register "+b[0];}a<<=4;return[a|c];},RQW:function(c,b){var a=this.RQQ(b[0]);if(a<0||a>3){throw"Unknown register "+b[0];}a<<=4;
return[a|c];},IW:function(b,a){return[b,function(c){return Parser.evaluate(a[0],c);},null];},RST:function(c,b){var a=parseInt(b[0],10);return[c|(a<<3)];
},"0":function(b,a){return[b];}},parseOpcode:function(b){var d=I8080.set[b.opcode];if(d){var c=d.t;var a=I8080.lens[c](d.o,b.params);b.bytes=a.length;b.lens=a;
b.resolve=a.reduce(function(e,f){return typeof(f)=="function"?e+1:e;},0);return b;}return null;}};var C6502={set:{SLO:[-1,-1,-1,15,31,27,7,23,-1,-1,3,19,-1],RLA:[-1,-1,-1,47,63,59,39,55,-1,-1,35,51,-1],SRE:[-1,-1,-1,79,95,91,71,87,-1,-1,67,83,-1],RRA:[-1,-1,-1,111,127,123,103,119,-1,-1,99,115,-1],SAX:[-1,-1,-1,143,-1,-1,135,-1,151,-1,131,-1,-1],LAX:[-1,-1,171,175,-1,191,167,-1,183,-1,163,179,-1],DCP:[-1,-1,-1,207,223,219,199,215,-1,-1,195,211,-1],ISC:[-1,-1,-1,239,255,251,231,247,-1,-1,227,243,-1],ANC:[-1,-1,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],ALR:[-1,-1,75,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],ARR:[-1,-1,107,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],XAA:[-1,-1,139,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],AXS:[-1,-1,203,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],AHX:[-1,-1,-1,-1,-1,159,-1,-1,-1,-1,-1,147,-1],SHY:[-1,-1,-1,-1,156,-1,-1,-1,-1,-1,-1,-1,-1],SHX:[-1,-1,-1,-1,-1,158,-1,-1,-1,-1,-1,-1,-1],TAS:[-1,-1,-1,-1,-1,155,-1,-1,-1,-1,-1,-1,-1],LAS:[-1,-1,-1,-1,-1,187,-1,-1,-1,-1,-1,-1,-1],ADC:[-1,-1,105,109,125,121,101,117,-1,-1,97,113,-1],AND:[-1,-1,41,45,61,57,37,53,-1,-1,33,49,-1],ASL:[-1,10,-1,14,30,-1,6,22,-1,-1,-1,-1,-1],BCC:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,144],BCS:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,176],BEQ:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,240],BIT:[-1,-1,-1,44,-1,-1,36,-1,-1,-1,-1,-1,-1],BMI:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,48],BNE:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,208],BPL:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,16],BRK:[0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],BVC:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,80],BVS:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,112],CLC:[24,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],CLD:[216,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],CLI:[88,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],CLV:[184,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],CMP:[-1,-1,201,205,221,217,197,213,-1,-1,193,209,-1],CPX:[-1,-1,224,236,-1,-1,228,-1,-1,-1,-1,-1,-1],CPY:[-1,-1,192,204,-1,-1,196,-1,-1,-1,-1,-1,-1],DEC:[-1,-1,-1,206,222,-1,198,214,-1,-1,-1,-1,-1],DEX:[202,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],DEY:[136,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],EOR:[-1,-1,73,77,93,89,69,85,-1,-1,65,81,-1],INC:[-1,-1,-1,238,254,-1,230,246,-1,-1,-1,-1,-1],INX:[232,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],INY:[200,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],JMP:[-1,-1,-1,76,-1,-1,-1,-1,-1,108,-1,-1,-1],JSR:[-1,-1,-1,32,-1,-1,-1,-1,-1,-1,-1,-1,-1],LDA:[-1,-1,169,173,189,185,165,181,-1,-1,161,177,-1],LDX:[-1,-1,162,174,-1,190,166,-1,182,-1,-1,-1,-1],LDY:[-1,-1,160,172,188,-1,164,180,-1,-1,-1,-1,-1],LSR:[-1,74,-1,78,94,-1,70,86,-1,-1,-1,-1,-1],NOP:[234,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],ORA:[-1,-1,9,13,29,25,5,21,-1,-1,1,17,-1],PHA:[72,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],PHP:[8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],PLA:[104,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],PLP:[40,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],ROL:[-1,42,-1,46,62,-1,38,54,-1,-1,-1,-1,-1],ROR:[-1,106,-1,110,126,-1,102,118,-1,-1,-1,-1,-1],RTI:[64,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],RTS:[96,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],SBC:[-1,-1,233,237,253,249,229,245,-1,-1,225,241,-1],SEC:[56,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],SED:[248,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],SEI:[120,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],STA:[-1,-1,-1,141,157,153,133,149,-1,-1,129,145,-1],STX:[-1,-1,-1,142,-1,-1,134,-1,150,-1,-1,-1,-1],STY:[-1,-1,-1,140,-1,-1,132,148,-1,-1,-1,-1,-1],TAX:[170,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],TAY:[168,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],TSX:[186,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],TXA:[138,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],TXS:[154,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],TYA:[152,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]},steptab:[1,1,2,3,3,3,2,2,2,3,2,2,2],parseOpcode:function(k,g){var a=C6502.set[k.opcode];
var h,j,i,d,c,b;if(a){c=[];if(!k.params){h=0;if(a[0]===-1){h=1;}}else{if(k.params.length==1){j=k.params[0];h=3;if(j==="A"){h=1;}if(j[0]==="#"){h=2;c[1]=function(e){return Parser.evaluate(j.substr(1),e);
};}if(j[0]==="*"){h=6;c[1]=function(e){return Parser.evaluate(j.substr(1),e);};}if(g){try{b=Parser.evaluate(j,g);if(b<256&&a[6]>=0){h=6;c[1]=function(e){return Parser.evaluate(j,e);
};}}catch(f){}}if(j[0]==="("&&j[j.length-1]===")"){h=9;j=j.substr(1,j.length-2);c[1]=function(e){return Parser.evaluate(j,e);};c[2]=null;}if(j.match(/^\$[0-9a-f]{1,2}$/i)&&a[6]>=0){h=6;
c[1]=function(e){return Parser.evaluate(j,e);};}if(h===3){if(a[3]==-1&&a[12]){h=12;c[1]=function(e){var l=Parser.evaluate(j,e)-e._PC-2;if(l<0){l=256+l;
}return l;};}else{c[1]=function(e){return Parser.evaluate(j,e);};c[2]=null;}}}else{if(k.params.length==2){j=k.params[0];b=null;if(g){try{b=Parser.evaluate(j,g);
}catch(f){}}i=k.params[1].toUpperCase();if(j.match(/^\$[0-9a-f]{1,2}$/i)){if(i==="X"){h=7;}if(i==="Y"){h=8;}c[1]=function(e){return Parser.evaluate(j,e);
};}else{if(j[0]==="*"){j=j.substr(1);if(i==="X"){h=7;}if(i==="Y"){h=8;}c[1]=function(e){return Parser.evaluate(j,e);};}else{if(b&&b<256&&(a[7]>=0||a[8]>=0)&&j[0]!=="("){if(i==="X"&&j[0]!=="("){h=7;
}if(i==="Y"&&j[0]!=="("){h=8;}c[1]=function(e){return Parser.evaluate(j,e);};}else{if(i==="X"){h=4;c[1]=function(e){return Parser.evaluate(j,e);};c[2]=null;
}if(i==="Y"&&j[0]!=="("){h=5;c[1]=function(e){return Parser.evaluate(j,e);};c[2]=null;}if(i==="Y"&&j[0]==="("){h=11;c[1]=function(e){return Parser.evaluate(j.substr(1,j.length-2),e);
};}if(i==="X)"&&j[0]==="("){h=10;c[1]=function(e){return Parser.evaluate(j.substr(1),e);};}}}}}}}c[0]=a[h];if(c[0]===null||c[0]=="-1"){throw"Bad addressing mode at line "+k.numline;
}k.admode=h;k.lens=c;k.bytes=C6502.steptab[h];return k;}return null;}};var M6809={set:{NEG:[-1,0,96,112,-1,-1,-1,-1],COM:[-1,3,99,115,-1,-1,-1,-1],LSR:[-1,4,100,116,-1,-1,-1,-1],ROR:[-1,6,102,118,-1,-1,-1,-1],ASR:[-1,7,103,119,-1,-1,-1,-1],LSL:[-1,8,104,120,-1,-1,-1,-1],ASL:[-1,8,104,120,-1,-1,-1,-1],ROL:[-1,9,105,121,-1,-1,-1,-1],DEC:[-1,10,106,122,-1,-1,-1,-1],INC:[-1,12,108,124,-1,-1,-1,-1],TST:[-1,13,109,125,-1,-1,-1,-1],JMP:[-1,14,110,126,-1,-1,-1,-1],CLR:[-1,15,111,127,-1,-1,-1,-1],LEAX:[-1,-1,48,-1,-1,-1,-1,-1],LEAY:[-1,-1,49,-1,-1,-1,-1,-1],LEAS:[-1,-1,50,-1,-1,-1,-1,-1],LEAU:[-1,-1,51,-1,-1,-1,-1,-1],NOP:[18,-1,-1,-1,-1,-1,-1,-1],SYNC:[19,-1,-1,-1,-1,-1,-1,-1],DAA:[25,-1,-1,-1,-1,-1,-1,-1],SEX:[29,-1,-1,-1,-1,-1,-1,-1],RTS:[57,-1,-1,-1,-1,-1,-1,-1],ABX:[58,-1,-1,-1,-1,-1,-1,-1],RTI:[59,-1,-1,-1,-1,-1,-1,-1],CWAI:[-1,-1,-1,-1,-1,60,-1,-1],MUL:[61,-1,-1,-1,-1,-1,-1,-1],SWI:[63,-1,-1,-1,-1,-1,-1,-1],SWI2:[4159,-1,-1,-1,-1,-1,-1,-1],SWI3:[4415,-1,-1,-1,-1,-1,-1,-1],NEGA:[64,-1,-1,-1,-1,-1,-1,-1],COMA:[67,-1,-1,-1,-1,-1,-1,-1],LSRA:[68,-1,-1,-1,-1,-1,-1,-1],RORA:[70,-1,-1,-1,-1,-1,-1,-1],ASRA:[71,-1,-1,-1,-1,-1,-1,-1],LSLA:[72,-1,-1,-1,-1,-1,-1,-1],ASLA:[72,-1,-1,-1,-1,-1,-1,-1],ROLA:[73,-1,-1,-1,-1,-1,-1,-1],DECA:[74,-1,-1,-1,-1,-1,-1,-1],INCA:[76,-1,-1,-1,-1,-1,-1,-1],TSTA:[77,-1,-1,-1,-1,-1,-1,-1],CLRA:[79,-1,-1,-1,-1,-1,-1,-1],NEGB:[80,-1,-1,-1,-1,-1,-1,-1],COMB:[83,-1,-1,-1,-1,-1,-1,-1],LSRB:[84,-1,-1,-1,-1,-1,-1,-1],RORB:[86,-1,-1,-1,-1,-1,-1,-1],ASRB:[87,-1,-1,-1,-1,-1,-1,-1],LSLB:[88,-1,-1,-1,-1,-1,-1,-1],ASLB:[88,-1,-1,-1,-1,-1,-1,-1],ROLB:[89,-1,-1,-1,-1,-1,-1,-1],DECB:[90,-1,-1,-1,-1,-1,-1,-1],INCB:[92,-1,-1,-1,-1,-1,-1,-1],TSTB:[93,-1,-1,-1,-1,-1,-1,-1],CLRB:[95,-1,-1,-1,-1,-1,-1,-1],SUBA:[-1,144,160,176,-1,128,-1,-1],CMPA:[-1,145,161,177,-1,129,-1,-1],SBCA:[-1,146,162,178,-1,130,-1,-1],ANDA:[-1,148,164,180,-1,132,-1,-1],BITA:[-1,149,165,181,-1,133,-1,-1],LDA:[-1,150,166,182,-1,134,-1,-1],STA:[-1,151,167,183,-1,-1,-1,-1],EORA:[-1,152,168,184,-1,136,-1,-1],ADCA:[-1,153,169,185,-1,137,-1,-1],ORA:[-1,154,170,186,-1,138,-1,-1],ADDA:[-1,155,171,187,-1,139,-1,-1],JSR:[-1,157,173,189,-1,-1,-1,-1],SUBD:[-1,147,163,179,-1,-1,131,-1],CMPX:[-1,156,172,188,-1,-1,140,-1],LDX:[-1,158,174,190,-1,-1,142,-1],STX:[-1,159,175,191,-1,-1,-1,-1],CMPD:[-1,4243,4259,4275,-1,-1,4227,-1],CMPY:[-1,4252,4268,4284,-1,-1,4236,-1],LDY:[-1,4254,4270,4286,-1,-1,4238,-1],STY:[-1,4255,4271,4287,-1,-1,-1,-1],LDS:[-1,4318,4334,4350,-1,-1,4302,-1],STS:[-1,4319,4335,4351,-1,-1,-1,-1],SUBB:[-1,208,224,240,-1,192,-1,-1],CMPB:[-1,209,225,241,-1,193,-1,-1],SBCB:[-1,210,226,242,-1,194,-1,-1],ANDB:[-1,212,228,244,-1,196,-1,-1],BITB:[-1,213,229,245,-1,197,-1,-1],LDB:[-1,214,230,246,-1,198,-1,-1],STB:[-1,215,231,247,-1,-1,-1,-1],EORB:[-1,216,232,248,-1,200,-1,-1],ADCB:[-1,217,233,249,-1,201,-1,-1],ORB:[-1,218,234,250,-1,202,-1,-1],ADDB:[-1,219,235,251,-1,203,-1,-1],ADDD:[-1,211,227,243,-1,-1,195,-1],LDD:[-1,220,236,252,-1,-1,204,-1],STD:[-1,221,237,253,-1,-1,-1,-1],LDU:[-1,222,238,254,-1,-1,206,-1],STU:[-1,223,239,255,-1,-1,-1,-1],CMPS:[-1,4508,4524,4540,-1,-1,4492,-1],CMPU:[-1,4499,4515,4531,-1,-1,4483,-1],LBRA:[-1,-1,-1,-1,-1,-1,-1,22],LBSR:[-1,-1,-1,-1,-1,-1,-1,23],BSR:[-1,-1,-1,-1,141,-1,-1,-1],BRA:[-1,-1,-1,-1,32,-1,-1,-1],BRN:[-1,-1,-1,-1,33,-1,-1,-1],BHI:[-1,-1,-1,-1,34,-1,-1,-1],BLS:[-1,-1,-1,-1,35,-1,-1,-1],BHS:[-1,-1,-1,-1,36,-1,-1,-1],BCC:[-1,-1,-1,-1,36,-1,-1,-1],BLO:[-1,-1,-1,-1,37,-1,-1,-1],BCS:[-1,-1,-1,-1,37,-1,-1,-1],BNE:[-1,-1,-1,-1,38,-1,-1,-1],BEQ:[-1,-1,-1,-1,39,-1,-1,-1],BVC:[-1,-1,-1,-1,40,-1,-1,-1],BVS:[-1,-1,-1,-1,41,-1,-1,-1],BPL:[-1,-1,-1,-1,42,-1,-1,-1],BMI:[-1,-1,-1,-1,43,-1,-1,-1],BGE:[-1,-1,-1,-1,44,-1,-1,-1],BLT:[-1,-1,-1,-1,45,-1,-1,-1],BGT:[-1,-1,-1,-1,46,-1,-1,-1],BLE:[-1,-1,-1,-1,47,-1,-1,-1],LBRN:[-1,-1,-1,-1,-1,-1,-1,4129],LBHI:[-1,-1,-1,-1,-1,-1,-1,4130],LBLS:[-1,-1,-1,-1,-1,-1,-1,4131],LBHS:[-1,-1,-1,-1,-1,-1,-1,4132],LBCC:[-1,-1,-1,-1,-1,-1,-1,4132],LBLO:[-1,-1,-1,-1,-1,-1,-1,4133],LBCS:[-1,-1,-1,-1,-1,-1,-1,4133],LBNE:[-1,-1,-1,-1,-1,-1,-1,4134],LBEQ:[-1,-1,-1,-1,-1,-1,-1,4135],LBVC:[-1,-1,-1,-1,-1,-1,-1,4136],LBVS:[-1,-1,-1,-1,-1,-1,-1,4137],LBPL:[-1,-1,-1,-1,-1,-1,-1,4138],LBMI:[-1,-1,-1,-1,-1,-1,-1,4139],LBGE:[-1,-1,-1,-1,-1,-1,-1,4140],LBLT:[-1,-1,-1,-1,-1,-1,-1,4141],LBGT:[-1,-1,-1,-1,-1,-1,-1,4142],LBLE:[-1,-1,-1,-1,-1,-1,-1,4143],ORCC:[-1,-1,-1,-1,-1,26,-1,-1],ANDCC:[-1,-1,-1,-1,-1,28,-1,-1]},parseOpcode:function(p,q){var h=function(e){var i=["D","X","Y","U","S","PC","","","A","B","CC","DP"].indexOf(e.toUpperCase());
if(i<0){throw"Not recognized register name";}return i;};var d=function(e){if(e.toUpperCase()=="D"){return 6;}var i=["CC","A","B","DP","X","Y","U","PC"].indexOf(e.toUpperCase());
if(i<0){throw"Not recognized register name";}return 1<<i;};var k=function(e){if(e.toUpperCase()=="D"){return 6;}var i=["CC","A","B","DP","X","Y","S","PC"].indexOf(e.toUpperCase());
if(i<0){throw"Not recognized register name";}return 1<<i;};var o=M6809.set[p.opcode];var x,c,b,f,m,l=0,a=-1,r;var j=0,n=null;p.lens=[];if(p.opcode=="EXG"){p.lens[0]=30;
}if(p.opcode=="TFR"){p.lens[0]=31;}if(p.opcode=="EXG"||p.opcode=="TFR"){p.bytes=2;if(p.params.length!=2){throw p.opcode+" needs exactly 2 registers  at line "+p.numline;
}p.lens[1]=(h(p.params[0])<<4)+h(p.params[1]);return p;}if(p.opcode=="PSHS"){p.lens[0]=52;p.bytes=2;p.lens[1]=0;for(r=0;r<p.params.length;r++){p.lens[1]|=d(p.params[r]);
}return p;}if(p.opcode=="PULS"){p.lens[0]=53;p.bytes=2;p.lens[1]=0;for(r=0;r<p.params.length;r++){p.lens[1]|=d(p.params[r]);}return p;}if(p.opcode=="PSHU"){p.lens[0]=54;
p.bytes=2;p.lens[1]=0;for(r=0;r<p.params.length;r++){p.lens[1]|=k(p.params[r]);}return p;}if(p.opcode=="PULU"){p.lens[0]=55;p.bytes=2;p.lens[1]=0;for(r=0;
r<p.params.length;r++){p.lens[1]|=k(p.params[r]);}return p;}if(o){if(o[0]>=0){if(o[0]>255){p.lens=[o[0]>>8,o[0]&255];p.bytes=2;return p;}p.lens=[o[0]];
p.bytes=1;return p;}if(p.params.length==1&&p.params[0][0]!=="["){p.bytes=0;c=p.params[0];if(c[0]=="#"){j=1;l=5;if(o[5]<0&&o[6]>=0){l=6;}}else{if(c[0]=="<"){j=1;
l=1;}else{if(c[0]==">"){j=1;l=3;}else{if(o[1]>=0){l=1;}if(o[3]>=0){l=3;}if(o[4]>=0){l=4;}if(o[7]>=0){l=7;}try{x=Parser.evaluate(c,q);if(x<256&&o[1]>=0){l=1;
}}catch(v){}}}}if(l===0){throw"Not detected addressing mode at line "+p.numline;}if(o[l]==-1){throw"Bad addressing mode at line "+p.numline;}a=o[l];if(l!=4&&l!=7){n=j?(function(e){return Parser.evaluate(c.substr(1),e);
}):(function(e){return Parser.evaluate(c,e);});}if(a>255){p.bytes+=2;}else{p.bytes+=1;}if(l==4){n=j?(function(e){var i=Parser.evaluate(c.substr(1),e)-e._PC-2;
if(i<0){i=256+i;}return i;}):(function(e){var i=Parser.evaluate(c,e)-e._PC-2;if(i<0){i=256+i;}return i;});}if(l==7){n=j?(function(e){var i=Parser.evaluate(c.substr(1),e)-e._PC-p.bytes;
if(i<0){i=65536+i;}return i;}):(function(e){var i=Parser.evaluate(c,e)-e._PC-p.bytes;if(i<0){i=65536+i;}return i;});}if(a>255){p.lens=[a>>8,a&255,n];}else{p.lens=[a,n];
}if(l==1){p.bytes++;}if(l==5){p.bytes++;}if(l==4){p.bytes++;}if(l==3){p.bytes+=2;p.lens[p.bytes-1]=null;}if(l==6){p.bytes+=2;p.lens[p.bytes-1]=null;}if(l==7){p.bytes+=2;
p.lens[p.bytes-1]=null;}return p;}var u=1;p.bytes=2;if(p.params.length==1&&p.params[0][0]==="["){if(o[2]>256){p.lens[0]=o[2]>>8;p.lens[1]=o[2]&255;u=2;
p.bytes++;}else{p.lens[0]=o[2];}c=p.params[0];p.lens[u]=159;p.lens[u+1]=function(e){return Parser.evaluate(c.substr(1,c.length-2),e);};p.lens[u+2]=null;
p.bytes+=2;return p;}if(o[2]<=0||p.params.length!==2){throw"Bad addressing mode at line "+p.numline;}if(o[2]>256){p.lens[0]=o[2]>>8;p.lens[1]=o[2]&255;
u=2;p.bytes++;}else{p.lens[0]=o[2];}var t=0;c=p.params[0];b=p.params[1];f=c;m=b;if(c[0]=="["&&b[b.length-1]=="]"){t=16;c=c.substr(1);b=b.substr(0,b.length-1);
}var w=function(e){var i=["X","Y","U","S"].indexOf(e.toUpperCase());if(i<0){throw"Register name not recognized: "+e;}return i<<5;};var g=function(e){var i=["X","Y","U","S","PC"].indexOf(e.toUpperCase());
if(i==4){return 4;}if(i<0){throw"Register name not recognized: "+e;}return i<<5;};if(c===""){if(b[0]=="-"){if(b[1]=="-"){p.lens[u]=w(b.substr(2))|131|t;
}else{if(t>0){throw"Cannot use predecrement with 1";}p.lens[u]=w(b.substr(1))|130;}}else{if(b[1]=="+"){if(b[2]=="+"){p.lens[u]=w(b.substr(0,1))|129|t;}else{if(t>0){throw"Cannot use postincrement with 1";
}p.lens[u]=w(b.substr(0,1))|128;}}else{p.lens[u]=w(b)|132|t;}}return p;}if(c.toUpperCase()==="A"){p.lens[u]=w(b)|134|t;return p;}if(c.toUpperCase()==="B"){p.lens[u]=w(b)|133|t;
return p;}if(c.toUpperCase()==="D"){p.lens[u]=w(b)|139|t;return p;}try{x=Parser.evaluate(c,q);if(b.toUpperCase()=="PC"){x-=q._PC;}}catch(v){x=null;}if(x<16&&x>-17&&g(b)!=4){p.lens[u]=w(b)|t|(x&31);
return p;}if(x<256&&x>-129&&x!==null){if(x<0){x=256+x;}p.lens[u]=g(b)|t|136;p.bytes++;if(b.toUpperCase()=="PC"){p.lens[u+1]=t?(function(e){var i=Parser.evaluate(f.substr(1),e)-e._PC-p.bytes;
if(i<0){i=256+i;}return i;}):(function(e){var i=Parser.evaluate(f,e)-e._PC-p.bytes;if(i<0){i=256+i;}return i;});}else{p.lens[u+1]=t?(function(e){return Parser.evaluate(f.substr(1),e);
}):(function(e){return Parser.evaluate(f,e);});}return p;}p.bytes+=2;p.lens[u]=g(b)|t|137;if(b.toUpperCase()=="PC"){p.lens[u+1]=t?(function(e){var i=Parser.evaluate(f.substr(1),e)-e._PC-p.bytes;
if(i<0){i+=65536;}return i;}):(function(e){var i=Parser.evaluate(f,e)-e._PC-p.bytes;if(i<0){i+=65536;}return i;});}else{p.lens[u+1]=t?(function(e){return Parser.evaluate(f.substr(1),e);
}):(function(e){return Parser.evaluate(f,e);});}p.lens[u+2]=null;return p;}return null;},endian:true};(function(a,b){if(typeof module!="undefined"){module.exports=b();}else{if(typeof define=="function"&&typeof define.amd=="object"){define(b);}else{this[a]=b();
}}}("ASM",function(){var b=null;var f=null;var x={};var C=false;var m=function(G){return G.map(function(I){var H=I.line;H=H.replace("&lt;","<");H=H.replace("&gt;",">");
while(H[H.length-1]==" "){H=H.substr(0,H.length-1);}I.line=H;if(H[0]!=" "){return I;}while(H[0]==" "){H=H.substr(1);}I.line=" "+H;return I;});};var g=function(G){return G.filter(function(I){var H=I.line;
while(H[0]==" "){H=H.substr(1);}return H.length?true:false;});};var q=function(G){return G.map(function(I){var H=I.line;var J={addr:0,line:";;;EMPTYLINE",numline:I.numline};
while(H[0]==" "){H=H.substr(1);}return H.length?I:J;});};var r=function(G){return m(g(G.split(/\n/)));};var A=function(H){var G=1;return H.map(function(I){return{line:I,numline:G++,addr:null,bytes:0};
});};var z=function(G){return G.replace(/^\s+|\s+$/g,"");};var v=function(O,I,S,X){var N=O.line;var L=N.match(/^\s*(\@{0,1}[a-zA-Z0-9-_]+):\s*(.*)/);if(L){O.label=L[1].toUpperCase();
N=L[2];}var K=N.match(/^\s*(\=)\s*(.*)/);if(K){O.opcode=K[1].toUpperCase();N=K[2];}else{K=N.match(/^\s*([\.a-zA-Z0-9-_]+)\s*(.*)/);if(K){O.opcode=K[1].toUpperCase();
N=K[2];}}if(N){while(N.match(/"(.*?);(.*?)"/g)){N=N.replace(/"(.*?);(.*?)"/g,'"$1§$2"');}var T=N.match(/^\s*([^;]*)(.*)/);if(T&&T[1].length){O.paramstring=T[1];
var Y=T[1];while(Y.match(/"(.*?),(.*?)"/g)){Y=Y.replace(/"(.*?),(.*?)"/g,'"$1€$2"');}var R=Y.match(/([0-9]+)\s*DUP\s*\((.*)\)/i);if(R){var V=parseInt(R[1]);
var H="";for(var U=0;U<V;U++){H+=R[2]+",";}Y=H.substring(0,H.length-1);}var P=Y.split(/\s*,\s*/);O.params=P.map(function(Z){return z(Z.replace(/€/g,",").replace(/§/g,";"));
});N=T[2].replace(/§/g,";");}}if(N){var J=N.match(/^\s*;*(.*)/);if(J){O.remark=J[1];if(!O.remark){O.remark=" ";}N="";}}O.notparsed=N;if(O.opcode==="ORG"){O.opcode=".ORG";
}if(O.opcode===".ERROR"){throw {msg:O.paramstring,s:O};}if(O.opcode===".EQU"){O.opcode="EQU";}if(O.opcode===".ORG"){try{return O;}catch(W){throw {msg:W.message,s:O};
}}if(O.opcode==="DEFB"){O.opcode="DB";return O;}if(O.opcode===".DB"){O.opcode="DB";return O;}if(O.opcode===".DW"){O.opcode="DW";return O;}if(O.opcode==="DEFW"){O.opcode="DW";
return O;}if(O.opcode==="DEFS"){O.opcode="DS";return O;}if(O.opcode==="DEFM"){O.opcode="DS";return O;}if(O.opcode==="EQU"||O.opcode==="="||O.opcode==="IF"||O.opcode==="IFN"||O.opcode==="ENDIF"||O.opcode===".INCLUDE"||O.opcode===".MACRO"||O.opcode===".ENDM"||O.opcode===".BLOCK"||O.opcode===".ENDBLOCK"||O.opcode===".REPT"||O.opcode===".CPU"||O.opcode===".ENT"||O.opcode===".ENGINE"||O.opcode==="END"||O.opcode===".END"||O.opcode==="BSZ"||O.opcode==="FCB"||O.opcode==="FCC"||O.opcode==="FDB"||O.opcode==="FILL"||O.opcode==="RMB"||O.opcode==="ZMB"||O.opcode===".PHASE"||O.opcode===".DEPHASE"||O.opcode==="DB"||O.opcode==="DS"||O.opcode==="DW"){return O;
}if(!O.opcode&&O.label){return O;}try{var M=b.parseOpcode(O);}catch(W){throw {msg:W,s:O};}if(M!==null){return M;}if(I[O.opcode]){O.macro=O.opcode;return O;
}if(!O.label&&!S){var G={line:O.line,numline:O.numline,addr:null,bytes:0};if(O.remark&&!O.opcode){return O;}if(!O.params){throw {msg:"Unrecognized instruction "+O.opcode,s:O};
}if(!O.opcode){throw {msg:"Unrecognized instruction "+O.opcode,s:O};}G.line=O.opcode+": "+O.params.join();var Q=v(G,I,true,O);if(!Q.opcode){throw {msg:"Unrecognized instruction "+O.opcode,s:O};
}return(Q);}if(S){throw {msg:"Unrecognized instruction "+X.opcode,s:O};}throw {msg:"Unrecognized instruction "+O.opcode,s:O};};var u=function(I){var N,O,P=null,S,ac=null;
var L={};var G=null;var M=null;var Z=[];var R=0;for(var X=0,U=I.length;X<U;X++){N=I[X].line;O=N.match(/\s*(\.[^\s]+)(.*)/);if(!O){if(G){L[G].push(I[X]);
continue;}else{Z.push(I[X]);}continue;}var Y=O[1].toUpperCase();var W=O[2].match(/^\s*([^;]*)(.*)/);if(W&&W[1].length){P=W[1];S=W[1].split(/\s*,\s*/);ac=S.map(z);
}else{ac=null;}if(Y===".INCLUDE"){if(!ac[0]){throw {msg:"No file name given at line "+N.numline,s:N};}if(x[ac[0]]){throw {msg:"File "+ac[0]+" is already included elsewhere - maybe recursion at line "+N.numline,s:N};
}var K=f(ac[0]);var J=A(K.split(/\n/));J=g(J);J=m(J);var H=u(J);for(var T=0;T<H[0].length;T++){H[0][T].includedFile=ac[0];Z.push(H[0][T]);}for(T in H[1]){L[T]=H[1][T];
}x[ac[0]]=K;continue;}if(Y===".ENDM"){if(!G){throw {msg:"ENDM without MACRO at line "+I[X].numline,s:I[X]};}if(M){Z.push({numline:I[X].numline,line:";rept unroll",addr:null,bytes:0,remark:"REPT unroll"});
for(var Q=0;Q<M;Q++){for(var aa=0;aa<L[G].length;aa++){var ab=L[G][aa].line;Z.push({numline:I[Q].numline,line:ab,addr:null,bytes:0});}}}G=null;M=null;continue;
}if(Y===".MACRO"){if(!ac[0]){throw {msg:"Bad macro name at line "+I[X].numline,s:I[X]};}G=ac[0].toUpperCase();if(L[G]){throw {msg:"Macro redefinition at line "+I[X].numline,s:I[X]};
}L[G]=[];continue;}if(Y===".REPT"){if(!ac[0]){throw {msg:"No repeat count given",s:I[X]};}M=Parser.evaluate(ac[0]);if(!M){throw {msg:"Bad repeat count given",s:I[X]};
}G="*REPT"+I[X].numline;if(L[G]){throw {msg:"Macro redefinition at line "+I[X].numline,s:I[X]};}L[G]=[];continue;}Z.push(I[X]);}if(G){throw {msg:"MACRO "+G+" has no appropriate ENDM",s:I[X]};
}return[Z,L];};var n=function(J,I){var G={line:J.line,addr:J.addr,macro:J.macro,numline:J.numline};for(var H=0;H<I.length;H++){G.line=G.line.replace("%%"+(H+1),I[H]);
}return G;};var d=function(H,L){var J=[];for(var K=0;K<H.length;K++){var M=H[K];if(!M.macro){J.push(M);continue;}var G=L[M.macro];for(var I=0;I<G.length;
I++){var N=v(n(G[I],M.params),L);if(M.label){N.label=M.label;}M.label="";N.remark=M.remark;N.macro=M.macro;M.macro=null;M.remark="";J.push(N);}}return J;
};var w=function(H,I){b=I;if(I.endian){C=I.endian;}x={};var G=A(H.split(/\n/));G=g(G);G=m(G);var J=u(G);G=J[0].map(function(K){return v(K,J[1]);});G=d(G,J[1]);
return G;};var s=function(I,L){b=L;var H=A(I.split(/\n/));H=q(H);H=g(H);H=m(H);var M=u(H);H=H.map(function(O){return v(O,M[1]);});var G="";var N,J;for(var K=0;
K<H.length;K++){N=H[K];J="";if(N.remark=="EMPTYLINE"){G+="\n";continue;}if(N.label){J+=N.label;if(N.opcode!="EQU"&&N.opcode!="="){J+=":";}J+=" ";}while(J.length<10){J+=" ";
}if(N.opcode){J+=N.opcode+" ";}while(J.length<18){J+=" ";}if(N.params){J+=N.params+" ";}if(N.remark){J+=";"+N.remark;}G+=J+"\n";}return G;};var l=function(I){var Z=0;
var R={};var L=null;var S,T;var O=0;var N;var ab=[];var J=0;for(var X=0,W=I.length;X<W;X++){L=I[X];L.pass=1;L.addr=Z;R._PC=Z;if(J!==0){L.phase=J;}if(L.opcode==="ENDIF"){O=0;
continue;}if(O){continue;}if(L.opcode==="IF"){try{N=Parser.evaluate(L.params[0],R);if(!N){O=1;}}catch(aa){O=1;}continue;}if(L.opcode==="IFN"){try{N=Parser.evaluate(L.params[0],R);
if(N){O=1;}}catch(aa){}continue;}if(L.opcode===".BLOCK"){ab.push(L.numline);var U=ab.join("/");R["__"+U]=[];continue;}if(L.opcode===".ENDBLOCK"){var ac=R["__"+ab.join("/")];
for(var H=0;H<ac.length;H++){R[ac[H]]=R[ab.join("/")+"/"+ac[H]];R[ab.join("/")+"/"+ac[H]]=null;}ab.pop();R.__blocks=JSON.stringify(ab);continue;}if(L.label){var G=L.label;
var P=false;if(G[0]==="@"){P=true;G=G.substr(1);L.label=G;}if(ab.length>0){G=ab.join("/")+"/"+G;R["__"+ab.join("/")].push(L.label);}if(R[G+"$"]||(P&&R[L.label]!==undefined)){throw {msg:"Redefine label "+L.label+" at line "+L.numline,s:L};
}if(R[L.label]){R[G]=R[L.label];}else{if(P){R[G]=Z;}}R[G+"$"]=Z;R[L.label]=Z;}try{if(L.opcode===".ORG"){Z=Parser.evaluate(L.params[0],R);L.addr=Z;continue;
}if(L.opcode===".PHASE"){var Y=Parser.evaluate(L.params[0],R);L.addr=Z;J=Y-Z;Z=Y;continue;}if(L.opcode===".DEPHASE"){L.addr=Z;Z=Z-J;J=0;continue;}if(L.opcode==="EQU"){try{R[L.label]=Parser.evaluate(L.params[0],R);
}catch(aa){R[L.label]=null;}continue;}if(L.opcode==="="){R[L.label]=Parser.evaluate(L.params[0],R);continue;}}catch(aa){throw {msg:aa.message,s:L};}if(L.opcode==="DB"||L.opcode==="FCB"){L.bytes=0;
for(T=0;T<L.params.length;T++){try{S=Parser.evaluate(L.params[T],R);if(typeof(S)==="number"){L.bytes++;continue;}if(typeof(S)==="string"){L.bytes+=S.length;
continue;}}catch(aa){L.bytes++;}}}if(L.opcode==="DS"||L.opcode==="RMB"){var Q=Parser.evaluate(L.params[0],R);if(L.params.length==2){var S=Parser.evaluate(L.params[1],R);
if(typeof S==="string"){S=S.charCodeAt(0);}L.bytes=Q;L.lens=[];for(var K=0;K<Q;K++){L.lens[K]=S;}}Z=Z+Q;continue;}if(L.opcode==="FILL"){var Q=Parser.evaluate(L.params[1],R);
var S=Parser.evaluate(L.params[0],R);if(typeof S==="string"){S=S.charCodeAt(0);}L.bytes=Q;L.lens=[];for(var K=0;K<Q;K++){L.lens[K]=S;}Z=Z+Q;continue;}if(L.opcode==="BSZ"||L.opcode==="ZMB"){var Q=Parser.evaluate(L.params[0],R);
L.bytes=Q;L.lens=[];for(var K=0;K<Q;K++){L.lens[K]=0;}Z=Z+Q;continue;}if(L.opcode==="DW"||L.opcode==="FDB"){L.bytes=0;for(T=0;T<L.params.length;T++){try{S=Parser.evaluate(L.params[T],R);
if(typeof(S)==="number"){L.bytes+=2;continue;}}catch(aa){L.bytes+=2;}}}var M=b.parseOpcode(I[X],R);if(M){L=M;}Z+=L.bytes;}return[I,R];};var t=function(I,H){var G=I.toString(16);
while(G.length<H){G="0"+G;}return G.toUpperCase();};var e=function(G){return t(G&255,2);};var c=function(G){return t(G,4);};var F=function(G){if(typeof(G)=="string"){return G.charCodeAt(0)&255;
}else{return G&255;}};var o=function(G){if(typeof(G)=="string"){return G.charCodeAt(0)&255;}else{return G&255;}};var j=function(R){var I=R[0];var Q=R[1];
var O=null,H=null,J,U,K;var G=[];for(var N=0,M=I.length;N<M;N++){try{O=I[N];O.pass=2;Q._PC=O.addr;if(O.opcode===".BLOCK"){G.push(O.numline);var S=Q["__"+G.join("/")];
for(var T=0;T<S.length;T++){Q[G.join("/")+"/"+S[T]]=Q[S[T]];Q[S[T]]=Q[G.join("/")+"/"+S[T]+"$"];}continue;}if(O.opcode===".ENDBLOCK"){var S=Q["__"+G.join("/")];
for(var T=0;T<S.length;T++){Q[S[T]]=Q[G.join("/")+"/"+S[T]];if(Q[S[T]]===undefined){delete (Q[S[T]]);}Q[G.join("/")+"/"+S[T]]=null;}G.pop();continue;}if(O.opcode===".ENT"){ASM.ENT=Parser.evaluate(O.params[0],Q);
continue;}if(O.opcode===".ENGINE"){ASM.ENGINE=O.params[0];continue;}if(O.opcode==="EQU"){Q[O.label]=Parser.evaluate(O.params[0],Q);continue;}if(O.opcode==="DB"||O.opcode==="FCB"){U=0;
O.lens=[];for(K=0;K<O.params.length;K++){J=Parser.evaluate(O.params[K],Q);if(typeof(J)==="number"){O.lens[U++]=Math.floor(J%256);continue;}if(typeof(J)==="string"){for(var L=0;
L<J.length;L++){O.lens[U++]=J.charCodeAt(L);}continue;}}continue;}if(O.opcode==="DW"||O.opcode==="FDB"){U=0;O.lens=[];for(K=0;K<O.params.length;K++){J=Parser.evaluate(O.params[K],Q);
if(typeof(J)==="number"){if(C){O.lens[U++]=Math.floor(J/256);O.lens[U++]=Math.floor(J%256);}else{O.lens[U++]=Math.floor(J%256);O.lens[U++]=Math.floor(J/256);
}continue;}}continue;}if(O.lens&&O.lens[1]&&typeof(O.lens[1])==="function"){if(O.lens[2]===null){H=O.lens[1](Q);if(typeof(H)=="string"){if(C){O.lens[1]=H.charCodeAt(0)&255;
O.lens[2]=H.charCodeAt(1)&255;}else{O.lens[2]=H.charCodeAt(0)&255;O.lens[1]=H.charCodeAt(1)&255;}}else{if(C){O.lens[2]=Math.floor(H%256);O.lens[1]=Math.floor(H/256);
}else{O.lens[1]=Math.floor(H%256);O.lens[2]=Math.floor(H/256);}}}else{H=O.lens[1](Q);O.lens[1]=F(H);}}if(O.lens&&O.lens.length>2&&typeof(O.lens[2])=="function"){H=O.lens[2](Q);
if(O.lens[3]===null){H=O.lens[2](Q);if(typeof(H)=="string"){if(C){O.lens[2]=H.charCodeAt(0)&255;O.lens[3]=H.charCodeAt(1)&255;}else{O.lens[3]=H.charCodeAt(0)&255;
O.lens[2]=H.charCodeAt(1)&255;}}else{if(C){O.lens[3]=H&255;O.lens[2]=H>>8;}else{O.lens[2]=H&255;O.lens[3]=H>>8;}}}else{O.lens[2]=F(H);}}if(O.lens&&O.lens.length>3&&typeof(O.lens[3])=="function"){H=O.lens[3](Q);
if(O.lens[4]===null){H=O.lens[3](Q);if(typeof(H)=="string"){if(C){O.lens[3]=H.charCodeAt(0)&255;O.lens[4]=H.charCodeAt(1)&255;}else{O.lens[4]=H.charCodeAt(0)&255;
O.lens[3]=H.charCodeAt(1)&255;}}else{if(C){O.lens[4]=H&255;O.lens[3]=H>>8;}else{O.lens[3]=H&255;O.lens[4]=H>>8;}}}else{O.lens[3]=F(H);}}if(O.lens&&O.lens.length>1){if(typeof(O.lens[1])=="string"){O.lens[1]=O.lens[1].charCodeAt(0);
}if(isNaN(O.lens[1])){throw {message:"param out of bounds, NaN"};}if(O.lens[1]>255||O.lens[1]<-128){throw {message:"param out of bounds - "+O.lens[1]};
}if(O.lens[1]<0){O.lens[1]=256+O.lens[1];}}}catch(P){throw {msg:P.message,s:O,e:P};}}return[I,Q];};var p=function(H,N,Q,P){var O;var M;var K="";if(P===undefined){P=false;
}for(var L=0,J=H.length;L<J;L++){M=H[L];O="";if(M.macro&&!Q){O+="        **MACRO UNROLL - "+M.macro+"\n";}if(M.addr!==undefined){O+=c(M.addr);if(M.phase){O+=" @"+c(M.addr-M.phase);
}O+=(P?" ":"   ");}if(M.lens){for(var G=0;G<M.lens.length;G++){O+=e(M.lens[G])+" ";}}if(!P){while(O.length<20){O+=" ";}}if(P){while(O.length<15){O+=" ";
}}if(M.label){O+=M.label+":   ";}if(!P){while(O.length<30){O+=" ";}}if(P){while(O.length<22){O+=" ";}}if(M.opcode){O+=M.opcode+(P?" ":"   ");}if(M.params){O+=M.params+(P?" ":"   ");
}if(M.remark){O+=";"+M.remark;}K+=O+"\n";}if(Q){return K;}K+="\n\n";for(var I in N){if(N[I]===null){continue;}if(I[0]=="_"&&I[1]=="_"){continue;}O="";O+=I;
while(O.length<12){O+=" ";}O+=c(N[I]);K+=O+"\n";}return K;};var h=function(G){var K;var M;var I=[];for(var J=0,H=G.length;J<H;J++){M=G[J];if(M.lens){for(var L=0;
L<M.lens.length;L++){I[M.addr+L]=J+1;}}}return I;};var B=function(L,H){var J=":";var G=H.length;var K=0;J+=e(G);J+=c(L);J+="00";K=G+Math.floor(L/256)+Math.floor(L%256);
for(var I=0;I<H.length;I++){J+=e(H[I]);K+=H[I];}J+=e(256-(K%256));return J;};var a=function(M,L){var G=0;var H=[];var K=16;var I="";for(var J=0;J<L.length;
J++){H.push(L[J]);if(++G===K){I+=B(M,H)+"\n";H=[];G=0;M+=K;}}if(H.length){I+=B(M,H)+"\n";}return I;};var E=function(I){var O;var M;var P=null;var N=0;var G=[];
var K="";for(var L=0,J=I.length;L<J;L++){M=I[L];var Q=M.addr;if(M.phase){Q-=M.phase;}if(Q!==undefined&&N===0){P=Q;}if(Q!=(P+N)){if(N){K+=a(P,G);}P=Q;N=0;
G=[];}if(M.lens){for(var H=0;H<M.lens.length;H++){G.push(M.lens[H]);}N+=M.lens.length;continue;}}if(G.length){K+=a(P,G);}K+=":00000001FF";return K;};var y=function(L,H){var J="S1";
var G=H.length;var K=0;J+=e(G+3);J+=c(L);K=G+3+Math.floor(L/256)+Math.floor(L%256);for(var I=0;I<H.length;I++){J+=e(H[I]);K+=H[I];}J+=e(256-(K%256));return J;
};var k=function(M,L){var G=0;var H=[];var K=16;var I="";for(var J=0;J<L.length;J++){H.push(L[J]);if(++G===K){I+=y(M,H)+"\n";H=[];G=0;M+=K;}}if(H.length){I+=y(M,H)+"\n";
}return I;};var i=function(I){var Q;var M;var R=null;var N=0;var G=[];var K="";for(var L=0,J=I.length;L<J;L++){M=I[L];var S=M.addr;if(M.phase){S-=M.phase;
}if(S!==undefined&&N===0){R=S;}if(S!=(R+N)){if(N){K+=k(R,G);}R=S;N=0;G=[];}if(M.lens){for(var H=0;H<M.lens.length;H++){G.push(M.lens[H]);}N+=M.lens.length;
continue;}}if(G.length){K+=k(R,G);}var P=ASM.ENT||0;var O=3+Math.floor(P/256)+Math.floor(P%256);K+="S903"+c(P)+e(255-(O%256));return K;};var D=function(G){var M=new Uint8Array(65536);
var L,K;for(var I=0,H=G.length;I<H;I++){L=G[I];K=L.addr;if(L.lens){for(var J=0;J<L.lens.length;J++){M[K++]=L.lens[J];}}}return M;};return{parse:w,pass1:l,pass2:j,parseLine:v,ENT:null,compile:function(K,I){try{ASM.ENT=null;
ASM.ENGINE=null;var G=ASM.parse(K,I);var H=ASM.pass1(G);H=ASM.pass2(H);return[null,H];}catch(J){return[J,null];}},compileAsync:function(L,J,G){try{var H=ASM.parse(L,J);
var I=ASM.pass1(H);I=ASM.pass2(I);G(null,I);}catch(K){G(K,null);}},lst:p,hex:E,srec:i,linemap:h,beautify:s,buff:D,fileGet:function(G){f=G;}};}));if(!Array.indexOf){Array.prototype.indexOf=function(b,c){for(var a=(c||0);a<this.length;a++){if(this[a]===b){return a;}}return -1;};}var Parser=(function(y){function C(L){function K(){}K.prototype=L;
return new K();}var D=0;var A=1;var x=2;var p=3;var v=4;function d(K,M,L,N){this.type_=K;this.index_=M||0;this.prio_=L||0;this.number_=(N!==undefined&&N!==null)?N:0;
this.toString=function(){switch(this.type_){case D:return this.number_;case A:case x:case p:return this.index_;case v:return"CALL";default:return"Invalid Token";
}};}function E(N,L,K,M){this.tokens=N;this.ops1=L;this.ops2=K;this.functions=M;}var o=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,F=/[\\\'\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","'":"\\'","\\":"\\\\"};
function z(K){if(typeof K==="string"){F.lastIndex=0;return F.test(K)?"'"+K.replace(F,function(L){var M=h[L];return typeof M==="string"?M:"\\u"+("0000"+L.charCodeAt(0).toString(16)).slice(-4);
})+"'":"'"+K+"'";}return K;}E.prototype={simplify:function(T){T=T||{};var O=[];var N=[];var R;var Q;var P;var S=this.tokens.length;var U;var M=0;for(M=0;
M<S;M++){U=this.tokens[M];var K=U.type_;if(K===D){O.push(U);}else{if(K===p&&(U.index_ in T)){U=new d(D,0,0,T[U.index_]);O.push(U);}else{if(K===x&&O.length>1){Q=O.pop();
R=O.pop();P=this.ops2[U.index_];U=new d(D,0,0,P(R.number_,Q.number_));O.push(U);}else{if(K===A&&O.length>0){R=O.pop();P=this.ops1[U.index_];U=new d(D,0,0,P(R.number_));
O.push(U);}else{while(O.length>0){N.push(O.shift());}N.push(U);}}}}}while(O.length>0){N.push(O.shift());}return new E(N,C(this.ops1),C(this.ops2),C(this.functions));
},substitute:function(M,U){if(!(U instanceof E)){U=new e().parse(String(U));}var R=[];var T=this.tokens.length;var V;var O=0;for(O=0;O<T;O++){V=this.tokens[O];
var P=V.type_;if(P===p&&V.index_===M){for(var N=0;N<U.tokens.length;N++){var Q=U.tokens[N];var K=new d(Q.type_,Q.index_,Q.prio_,Q.number_);R.push(K);}}else{R.push(V);
}}var S=new E(R,C(this.ops1),C(this.ops2),C(this.functions));return S;},evaluate:function(S){S=S||{};var N=[];var Q;var P;var O;var R=this.tokens.length;
var T;var M=0;for(M=0;M<R;M++){T=this.tokens[M];var K=T.type_;if(K===D){N.push(T.number_);}else{if(K===x){P=N.pop();Q=N.pop();O=this.ops2[T.index_];N.push(O(Q,P));
}else{if(K===p){T.index_=T.index_.toUpperCase();if(T.index_[0]==="<"){if(T.index_.substr(1) in S){N.push(S[T.index_.substr(1)]%256);}}else{if(T.index_[0]===">"){if(T.index_.substr(1) in S){N.push(Math.floor(S[T.index_.substr(1)]/256));
}}else{if(T.index_ in S){N.push(S[T.index_]);}else{if(T.index_ in this.functions){N.push(this.functions[T.index_]);}else{throw new Error("undefined variable: "+T.index_);
}}}}}else{if(K===A){Q=N.pop();O=this.ops1[T.index_];N.push(O(Q));}else{if(K===v){Q=N.pop();O=N.pop();if(O.apply&&O.call){if(Object.prototype.toString.call(Q)=="[object Array]"){N.push(O.apply(undefined,Q));
}else{N.push(O.call(undefined,Q));}}else{throw new Error(O+" is not a function");}}else{throw new Error("invalid Expression");}}}}}}if(N.length>1){throw new Error("invalid Expression (parity)");
}return N[0];},toString:function(O){var N=[];var R;var Q;var P;var S=this.tokens.length;var T;var M=0;for(M=0;M<S;M++){T=this.tokens[M];var K=T.type_;if(K===D){N.push(z(T.number_));
}else{if(K===x){Q=N.pop();R=N.pop();P=T.index_;if(O&&P=="^"){N.push("Math.pow("+R+","+Q+")");}else{N.push("("+R+P+Q+")");}}else{if(K===p){N.push(T.index_);
}else{if(K===A){R=N.pop();P=T.index_;if(P==="-"){N.push("("+P+R+")");}else{N.push(P+"("+R+")");}}else{if(K===v){R=N.pop();P=N.pop();N.push(P+"("+R+")");
}else{throw new Error("invalid Expression");}}}}}}if(N.length>1){throw new Error("invalid Expression (parity)");}return N[0];},variables:function(){var K=this.tokens.length;
var O=[];for(var M=0;M<K;M++){var N=this.tokens[M];if(N.type_===p&&(O.indexOf(N.index_)==-1)){O.push(N.index_);}}return O;},toJSFunction:function(L,M){var K=new Function(L,"with(Parser.values) { return "+this.simplify(M).toString(true)+"; }");
return K;}};function a(L){var M=0;for(var K=0;K<L.length;K++){M*=256;M+=L.charCodeAt(K);}return M;}function f(L,K){if(typeof(L)=="string"){L=a(L);}if(typeof(K)=="string"){K=a(K);
}return Number(L)+Number(K);}function w(L,K){return Number(L)&Number(K);}function q(L,K){return L-K;}function c(L,K){return L*K;}function I(L,K){return L/K;
}function g(L,K){return L%K;}function t(L,K){return""+L+K;}function j(K){return -K;}function s(K){return Math.random()*(K||1);}function r(L){L=Math.floor(L);
var K=L;while(L>1){K=K*(--L);}return K;}function l(L,K){return Math.sqrt(L*L+K*K);}function B(L,K){if(Object.prototype.toString.call(L)!="[object Array]"){return[L,K];
}L=L.slice();L.push(K);return L;}function e(){this.success=false;this.errormsg="";this.expression="";this.pos=0;this.tokennumber=0;this.tokenprio=0;this.tokenindex=0;
this.tmpprio=0;this.ops1={lsb:function(K){Math.floor(K%256);},msb:function(K){Math.floor(K/256);},sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sqrt:Math.sqrt,log:Math.log,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,"-":j,exp:Math.exp};
this.ops2={"+":f,"-":q,"*":c,"/":I,"%":g,"#":g,"^":Math.pow,",":B,"&":w,"||":t};this.functions={random:s,fac:r,min:Math.min,max:Math.max,pyt:l,pow:Math.pow,atan2:Math.atan2};
this.consts={};}e.parse=function(K){return new e().parse(K);};e.evaluate=function(K,L){return e.parse(K).evaluate(L);};e.Expression=E;e.values={lsb:function(K){Math.floor(K%256);
},msb:function(K){Math.floor(K/256);},sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sqrt:Math.sqrt,log:Math.log,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,random:s,fac:r,exp:Math.exp,min:Math.min,max:Math.max,pyt:l,pow:Math.pow,atan2:Math.atan2,E:Math.E,PI:Math.PI};
var J=1<<0;var G=1<<1;var b=1<<2;var i=1<<3;var k=1<<4;var m=1<<5;var u=1<<6;var n=1<<7;var H=1<<8;e.prototype={parse:function(R){this.errormsg="";this.success=true;
var M=[];var S=[];this.tmpprio=0;var O=(J|i|b|u);var P=0;this.expression=R;this.pos=0;while(this.pos<this.expression.length){if(this.isNumber()){if((O&J)===0){this.error_parsing(this.pos,"unexpected number");
}var L=new d(D,0,0,this.tokennumber);S.push(L);O=(G|k|m);}else{if(this.isOperator()){if(this.isSign()&&(O&u)){if(this.isNegativeSign()){this.tokenprio=2;
this.tokenindex="-";P++;this.addfunc(S,M,A);}O=(J|i|b|u);}else{if(this.isComment()){}else{if((O&G)===0){this.error_parsing(this.pos,"unexpected operator");
}P+=2;this.addfunc(S,M,x);O=(J|i|b|u);}}}else{if(this.isString()){if((O&J)===0){this.error_parsing(this.pos,"unexpected string");}var L=new d(D,0,0,this.tokennumber);
S.push(L);O=(G|k|m);}else{if(this.isLeftParenth()){if((O&i)===0){this.error_parsing(this.pos,'unexpected "("');}if(O&n){P+=2;this.tokenprio=-2;this.tokenindex=-1;
this.addfunc(S,M,v);}O=(J|i|b|u|H);}else{if(this.isRightParenth()){if(O&H){var L=new d(D,0,0,[]);S.push(L);}else{if((O&k)===0){this.error_parsing(this.pos,'unexpected ")"');
}}O=(G|k|m|i|n);}else{if(this.isComma()){if((O&m)===0){this.error_parsing(this.pos,'unexpected ","');}this.addfunc(S,M,x);P+=2;O=(J|i|b|u);}else{if(this.isConst()){if((O&J)===0){this.error_parsing(this.pos,"unexpected constant");
}var K=new d(D,0,0,this.tokennumber);S.push(K);O=(G|k|m);}else{if(this.isOp2()){if((O&b)===0){this.error_parsing(this.pos,"unexpected function");}this.addfunc(S,M,x);
P+=2;O=(i);}else{if(this.isOp1()){if((O&b)===0){this.error_parsing(this.pos,"unexpected function");}this.addfunc(S,M,A);P++;O=(i);}else{if(this.isVar()){if((O&J)===0){this.error_parsing(this.pos,"unexpected variable");
}var Q=new d(p,this.tokenindex,0,0);S.push(Q);O=(G|k|m|i|n);}else{if(this.isWhite()){}else{if(this.errormsg===""){this.error_parsing(this.pos,"unknown character");
}else{this.error_parsing(this.pos,this.errormsg);}}}}}}}}}}}}}if(this.tmpprio<0||this.tmpprio>=10){this.error_parsing(this.pos,'unmatched "()"');}while(M.length>0){var N=M.pop();
S.push(N);}if(P+1!==S.length){this.error_parsing(this.pos,"parity");}return new E(S,C(this.ops1),C(this.ops2),C(this.functions));},evaluate:function(K,L){return this.parse(K).evaluate(L);
},error_parsing:function(K,L){this.success=false;this.errormsg="parse error [column "+(K)+"]: "+L;throw new Error(this.errormsg);},addfunc:function(N,K,M){var L=new d(M,this.tokenindex,this.tokenprio+this.tmpprio,0);
while(K.length>0){if(L.prio_<=K[K.length-1].prio_){N.push(K.pop());}else{break;}}K.push(L);},isNumber:function(){var M=false;var P="";var O=0;var N=10;
var Q=this.pos;while(this.pos<this.expression.length){var K;var L=this.expression.charCodeAt(this.pos);if((L>=48&&L<=57)||L===46||(O===0&&L===36)||(O===0&&L===37)||(O===1&&L===88)||(O===1&&L===120)||(O>0&&L===72)||(O>0&&L===104)||(O>0&&L===66)||(O>0&&L===98)||(O>0&&(L>=65&&L<=70))||(O>0&&(L>=97&&L<=102))){O++;
P+=this.expression.charAt(this.pos);this.pos++;K=P;if(P[0]==="$"){K="0x"+P.substr(1);N=16;}if((P[1]==="x")||(P[1]==="X")){N=16;}if((P[P.length-1]==="h")||(P[P.length-1]==="H")){if(N==10||N==2){K="0x"+P.substr(0,P.length-1);
N=16;}}if((P[P.length-1]==="b")||(P[P.length-1]==="B")){if(N==10){K=P.substr(0,P.length-1);N=2;}}if(P[0]==="%"){if(P.length<2){this.pos=Q;return false;
}K=P.substr(1);N=2;}this.tokennumber=parseInt(K,N);M=true;}else{break;}}if(K==="0x"){this.pos=Q;return false;}return M;},unescape:function(L,Q){var K=[];
var P=false;for(var N=0;N<L.length;N++){var O=L.charAt(N);if(P){switch(O){case"'":K.push("'");break;case"\\":K.push("\\");break;case"/":K.push("/");break;
case"b":K.push("\b");break;case"f":K.push("\f");break;case"n":K.push("\n");break;case"r":K.push("\r");break;case"t":K.push("\t");break;case"u":var M=parseInt(L.substring(N+1,N+5),16);
K.push(String.fromCharCode(M));N+=4;break;default:throw this.error_parsing(Q+N,"Illegal escape sequence: '\\"+O+"'");}P=false;}else{if(O=="\\"){P=true;
}else{K.push(O);}}}return K.join("");},isString:function(){var L=false;var O="";var M=this.pos;if(this.pos<this.expression.length&&(this.expression.charAt(this.pos)=="'")||this.expression.charAt(this.pos)=='"'){var N=this.expression.charAt(this.pos);
this.pos++;while(this.pos<this.expression.length){var K=this.expression.charAt(this.pos);if(K!=N||O.slice(-1)=="\\"){O+=this.expression.charAt(this.pos);
this.pos++;}else{this.pos++;this.tokennumber=this.unescape(O,M);L=true;break;}}}return L;},isConst:function(){return false;var N;for(var M in this.consts){if(true){var K=M.length;
N=this.expression.substr(this.pos,K);if(M===N){this.tokennumber=this.consts[M];this.pos+=K;return true;}}}return false;},isOperator:function(){var K=this.expression.charCodeAt(this.pos);
if(K===43){this.tokenprio=0;this.tokenindex="+";}else{if(K===45){this.tokenprio=0;this.tokenindex="-";}else{if(K===124){if(this.expression.charCodeAt(this.pos+1)===124){this.pos++;
this.tokenprio=0;this.tokenindex="||";}else{return false;}}else{if(K===42){this.tokenprio=1;this.tokenindex="*";}else{if(K===47){this.tokenprio=2;this.tokenindex="/";
}else{if(K===37){this.tokenprio=2;this.tokenindex="%";}else{if(K===35){this.tokenprio=2;this.tokenindex="#";}else{if(K===94){this.tokenprio=3;this.tokenindex="^";
}else{if(K===38){this.tokenprio=4;this.tokenindex="&";}else{return false;}}}}}}}}}this.pos++;return true;},isSign:function(){var K=this.expression.charCodeAt(this.pos-1);
if(K===45||K===43){return true;}return false;},isPositiveSign:function(){var K=this.expression.charCodeAt(this.pos-1);if(K===43){return true;}return false;
},isNegativeSign:function(){var K=this.expression.charCodeAt(this.pos-1);if(K===45){return true;}return false;},isLeftParenth:function(){var K=this.expression.charCodeAt(this.pos);
if(K===40){this.pos++;this.tmpprio+=10;return true;}return false;},isRightParenth:function(){var K=this.expression.charCodeAt(this.pos);if(K===41){this.pos++;
this.tmpprio-=10;return true;}return false;},isComma:function(){var K=this.expression.charCodeAt(this.pos);if(K===44){this.pos++;this.tokenprio=-1;this.tokenindex=",";
return true;}return false;},isWhite:function(){var K=this.expression.charCodeAt(this.pos);if(K===32||K===9||K===10||K===13){this.pos++;return true;}return false;
},isOp1:function(){var L="";for(var K=this.pos;K<this.expression.length;K++){var M=this.expression.charAt(K);if(M.toUpperCase()===M.toLowerCase()){if(K===this.pos||(M!="_"&&(M<"0"||M>"9"))){break;
}}L+=M;}if(L.length>0&&(L in this.ops1)){this.tokenindex=L;this.tokenprio=5;this.pos+=L.length;return true;}return false;},isOp2:function(){var L="";for(var K=this.pos;
K<this.expression.length;K++){var M=this.expression.charAt(K);if(M.toUpperCase()===M.toLowerCase()){if(K===this.pos||(M!="_"&&(M<"0"||M>"9"))){break;}}L+=M;
}if(L.length>0&&(L in this.ops2)){this.tokenindex=L;this.tokenprio=5;this.pos+=L.length;return true;}return false;},isVar:function(){var L="";for(var K=this.pos;
K<this.expression.length;K++){var M=this.expression.charAt(K);if(M==="$"){L="_PC";break;}if(M.toUpperCase()===M.toLowerCase()&&((M!=="<")&&(M!==">"))){if(K===this.pos||(M!="_"&&(M<"0"||M>"9"))){break;
}}L+=M;}if(L.length>0){this.tokenindex=L;this.tokenprio=4;if(L!=="_PC"){this.pos+=L.length;}else{this.pos++;}return true;}return false;},isComment:function(){var K=this.expression.charCodeAt(this.pos-1);
if(K===47&&this.expression.charCodeAt(this.pos)===42){this.pos=this.expression.indexOf("*/",this.pos)+2;if(this.pos===1){this.pos=this.expression.length;
}return true;}return false;}};y.Parser=e;return e;})(typeof exports==="undefined"?{}:exports);